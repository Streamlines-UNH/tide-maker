version: 0.2

env:
    variables:
        BUCKET: lambda-deploy-artifacts-sbsc
phases:
    install:
        runtime-versions:
            python: 3.7
        commands:
            - pip3 install -r functions/requirements.txt
    build:
        commands:
            - export GIT_BRANCH="$(git symbolic-ref HEAD --short 2>/dev/null)"
            - export PREFIX=`if [ "$GIT_BRANCH" == "dev" ]; then echo "dev-"; else echo ""; fi`
            - aws cloudformation package --template-file template.yaml --s3-bucket $BUCKET --output-template-file outputtemplate.yaml
artifacts:
    type: zip
    files:
        - template.yaml
        - outputtemplate.yaml
